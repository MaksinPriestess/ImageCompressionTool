# ImageCompressionTool

ImageCompressionTool — это утилита на Node.js для автоматизированного пакетного сжатия изображений с помощью `pngquant`, `mozjpeg` и `ImageMagick`.
Она позволяет быстро обрабатывать большие объёмы изображений, подбирать оптимальные профили качества, а также получать детальную статистику по каждому файлу в удобном CSV-формате.

Этот инструмент будет полезен, если:
- Нужно массово сжимать PNG и JPEG без потери заметного качества.
- Хочется сравнить разные параметры сжатия и выбрать лучший баланс размера/качества.
- Нужно автоматизировать подготовку ассетов для веба, игр или приложений.
- Требуется наглядный отчёт по результатам сжатия.

## Возможности
- Поддержка PNG и JPEG.
- Настройка профилей сжатия (например, soft и strong) или создание собственных.
- Гибкий выбор инструментов и порядка их запуска в пайплайне.
- Сохранение отдельных файлов для каждого шага обработки.
- Автоматическая генерация отчёта в CSV.
- Рекурсивная обработка папок.
- Параллельная обработка нескольких файлов.

## Требования
- Node.js 18 или новее.

## Установка необходимых утилит
- `pngquant`
- `mozjpeg` (`cjpeg.exe`)
- `ImageMagick` (`magick.exe`)

## Установка
1. Установите необходимые утилиты (`pngquant`, `mozjpeg`, `ImageMagick`).
2. Клонируйте репозиторий:
```bash
git clone https://github.com/yourname/ImageCompressionTool.git
cd ImageCompressionTool
```
3. Установите зависимости:
```bash
npm install
```

## Запуск
Запустите скрипт двойным кликом по `run.bat` (Windows)  
или через терминал:
```bash
run.bat
```
или
```bash
node index.js
```

По умолчанию используется `config.json` в корневой папке проекта.

## Конфигурация (config.json)
- **paths** — пути к папкам input/output и исполняемым файлам утилит.
- **selection** — расширения файлов для обработки и исключаемые шаблоны.
- **profiles** — параметры сжатия для каждого инструмента.
- **pipeline** — список шагов обработки, их порядок и профили.
- **logging** — путь к CSV-отчёту и режим записи.
- **options** — глубина обхода, сохранение структуры, количество потоков, режим dry-run.

### Пример
```json
{
  "profiles": {
    "soft": {
      "pngquant": ["--force", "--speed", "2", "--quality", "70-90"],
      "mozjpeg": ["-quality", "82", "-progressive", "-optimize"]
    },
    "strong": {
      "pngquant": ["--force", "--speed", "1", "--quality", "55-80"],
      "mozjpeg": ["-quality", "75", "-progressive", "-optimize"]
    }
  }
}
```

## Расшифровка статистики CSV
- **file** — путь к обработанному файлу.
- **stage** — этап обработки (инструмент и профиль).
- **src_size** — исходный размер файла (байты).
- **out_size** — размер после обработки (байты).
- **delta** — разница в байтах между исходным и сжатым файлом.
- **delta_pct** — изменение размера в процентах.
- **elapsed_ms** — время обработки в миллисекундах.
- **status** — статус выполнения (`ok` или `error`).
- **message** — сообщение об ошибке (если есть).

## Пример использования
1. Скопируйте изображения в папку `input`.
2. Запустите `node index.js`.
3. Готовые файлы будут в папке `output`.
4. Статистика по сжатию будет сохранена в `report.csv`.
